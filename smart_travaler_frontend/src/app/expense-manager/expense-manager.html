<div class="page-container">
  <main class="expense-card">
    
    <header class="card-header">
      <h1 class="card-title">Expense Manager</h1>
      <p class="card-subtitle">Track and manage your trip-related spending with ease.</p>
    </header>

    <section class="summary-section">
      <div class="total-display">
        <span class="total-label">Your Total Bills</span>
        <span class="total-amount">{{ totalAmount() | currency:'INR':'symbol' }}</span>
      </div>

      @if (selectedGroup() === 'multiple' && totalPerPerson() > 0) {
        <div class="split-display">
          <span class="total-label">Total Per Person</span>
          <span class="split-amount">{{ totalPerPerson() | currency:'INR':'symbol' }}</span>
        </div>
      }
      
      <div class="group-selector">
        <div class="radio-wrapper">
          <span class="group-label">Expense Type</span>
          <div class="radio-group">
            <label><input type="radio" name="group" value="single" [(ngModel)]="selectedGroup"> Personal</label>
            <label><input type="radio" name="group" value="multiple" [(ngModel)]="selectedGroup"> Group</label>
          </div>
        </div>
      
        @if (selectedGroup() === 'multiple') {
          <div class="member-count-selector">
            <label class="group-label" for="memberCount">Number of Members</label>
            <select id="memberCount" [(ngModel)]="numberOfMembers" name="memberCount">
              @for (num of memberCountOptions; track num) {
                <option [value]="num">{{ num }}</option>
              }
            </select>
          </div>
        }
      </div>
    </section>

    <div class="divider"></div>

    <section class="form-section">
      <h2 class="section-title">Add New Expense</h2>
      <form (ngSubmit)="addExpense()" class="expense-form">
        <div class="form-row">
          <label>
            <span>Category</span>
            <select [(ngModel)]="newExpenseCategory" name="category">
              <optgroup label="Travel">
                <option value="Flight">✈ Flight</option>
                <option value="Train">🚆 Train</option>
                <option value="Bus">🚌 Bus</option>
                <option value="Cabs">🚗 Cabs</option>
              </optgroup>
              <option value="Hotels">🏨 Hotels</option>
              <option value="Restaurants">🍴 Restaurants</option>
              <option value="Activities">🎟 Activities</option>
              <option value="Other">🛍 Other</option>
            </select>
          </label>
          <label>
            <span>Description</span>
            <input type="text" [(ngModel)]="newExpenseDescription" name="description" placeholder="e.g., Round trip to Paris" required>
          </label>
        </div>
        <div class="form-row">
          <label>
            <span>Date</span>
            <input type="date" [(ngModel)]="newExpenseDate" name="date" required>
          </label>
          <label>
            <span>Amount</span>
            <input type="number" [(ngModel)]="newExpenseAmount" name="amount" placeholder="0.00" min="0.01" step="0.01" required>
          </label>
        </div>
        <button type="submit" class="btn-submit">Add Expense</button>
      </form>
    </section>
    
    <div class="divider"></div>

    <section class="history-section">
      <h2 class="section-title">Expense History</h2>
      
      @if (expenses().length > 0) {
        <ul class="expense-list">
          @for (expense of expenses(); track expense.id) {
            <li class="expense-item">
              <div class="item-content">
                <div class="item-details">
                  <span class="item-category">{{ expense.category }}</span>
                  <span class="item-description">{{ expense.description }}</span>
                  <span class="item-date">{{ expense.date | date:'mediumDate' }}</span>
                </div>
                @if (expense.splitWith && expense.splitWith > 1) {
                  <div class="item-split-details">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                      <path d="M15 14s1 0 1-1-1-4-6-4-6 3-6 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.553.69.758 1.457.76 1.72l-.008.004-.014.004H15a1 1 0 0 1 1 1v.5a.5.5 0 0 1-1 0V15h-1a1 1 0 0 1-1-1v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-.5a.5.5 0 0 1 1 0V15h1a1 1 0 0 1 1-1v-.5a.5.5 0 0 1-1 0v.5a.5.5 0 0 1-1 0V14zM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                      <path d="M5.5 5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5m.354-2.854a.5.5 0 0 0-.708-.708L4 2.293 2.854 1.146a.5.5 0 1 0-.708.708L3.293 3 2.146 4.146a.5.5 0 0 0 .708.708L4 3.707l1.146 1.147a.5.5 0 0 0 .708-.708L4.707 3z"/>
                    </svg>
                    <span>Split with <strong>{{ expense.splitWith }}</strong>:</span>
                    <span class="split-per-person">{{ expense.amountPerPerson | currency:'INR':'symbol' }} each</span>
                  </div>
                }
              </div>
              <div class="item-actions">
                <span class="item-amount">{{ expense.amount | currency:'INR':'symbol' }}</span>
                <button (click)="removeExpense(expense.id)" class="btn-remove" title="Remove Expense">&times;</button>
              </div>
            </li>
          }
        </ul>
      } @else {
        <p class="empty-state">No expenses added yet. Use the form above to get started!</p>
      }
    </section>

  </main>
</div>